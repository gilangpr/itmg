<?php 

class Meetingdocumentation_RequestController extends Zend_Controller_Action
{
	protected $_model;
	protected $_limit;
	protected $_start;
	protected $_posts;
	protected $_error_code;
	protected $_error_message;
	protected $_success;
	
	public function init()
	{
		$this->_helper->layout()->disableLayout();
		$this->_helper->viewRenderer->setNoRender(true);
		$this->_model = new Application_Model_Meetingdocumentation();
		if($this->getRequest()->isPost()) {
			$this->_posts = $this->getRequest()->getPost();
		} else {
			$this->_posts = array();
		}
		
		$this->_start = (isset($this->_posts['start'])) ? $this->_posts['start'] : 0;
		$this->_limit = (isset($this->_posts['limit'])) ? $this->_posts['limit'] : 25;
		
		$this->_error_code = 0;
		$this->_error_message = '';
		$this->_success = true;
	}
	public function createAction()
	{	$upload = $this->_posts['FILE_PATH'];
		$upload = new Zend_File_Transfer_Adapter_Http();
		$upload ->setDestination(APPLICATION_PATH ."/../public/upload/meetings/");
		//$upload->setDestination('/var/www/html/itmg/docs/');		
		$upload ->addValidator('Extension',false, array('docx','doc','xlxs','txt','case'=>true))
			->addValidator('Count', false, 1);
		$upload ->receive();
		$name = $upload ->getFileName();
		$data = array(
			'data' => array()
		);
		
		try {
			// Insert Data :
			
 			$this->_model->insert(array(
					'MEETING_ACTIIVITIES_ID'=>$this->_posts['MEETING_ACTIVITIES_ID'],
					'DOCUMENTATION_TITLE'=>$this->_posts['DOCUMENTATION_TITLE'],
 					'FILE_PATH'=> $this->_name,
 					'CREATED_DATE' => date('Y-m-d H:i:s')
 					));
		}catch(Exception $e) {
			$this->_error_code = $e->getCode();
			$this->_error_message = $e->getMessage();
			$this->_success = false;
		}
		
		MyIndo_Tools_Return::JSON($data, $this->_error_code, $this->_error_message, $this->_success);
	}
	public function readAction()
	{
	$data = array(
		'data' => array(
		'items' => $this->_model->getListMeetingdocumentationLimit($this->_limit, $this->_start),
						'totalCount' => $this->_model->count()
						)
				);
	
		MyIndo_Tools_Return::JSON($data);
	}
	
	public function searchAction() 
	{
		$data = array(
				'data' => array(
						'items' => array(),
						'totalCount' => 0
						)
				);
		MyIndo_Tools_Return::JSON($data, $this->_error_code, $this->_error_message, $this->_success);
	}
}
